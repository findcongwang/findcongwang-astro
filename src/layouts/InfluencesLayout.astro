---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import BlogEntry from "@/components/blog/BlogEntry.astro";
// Load all posts
import { getCollection } from "astro:content";
// Content
const allPosts = await getCollection("posts");
// Get the influence slug from the URL
const influenceSlug = Astro.url.pathname.split("/").filter(Boolean).pop();
// Filter posts by this influence (based on slug)
const relatedPosts = allPosts.filter((post) => post.data.domains?.includes(influenceSlug));
const { frontmatter } = Astro.props;
---

<BaseLayout>
  <section>
    <Wrapper variant="standard" class="pt-24 pb-12 lg:pt-48">
      <div class="flex items-center gap-4">
        <Image
          width={1000}
          height={800}
          alt={frontmatter.image.alt}
          src={frontmatter.image.url}
          class="object-cover object-center size-12 rounded-full"
        />
        <div>
          <Text tag="h1" variant="textBase" class="text-primary">
            {frontmatter.name} {frontmatter.type && <span class="ml-2 text-primary/50 capitalize">({frontmatter.type})</span>}
          </Text>

          <Text
            tag="p"
            variant="textBase"
            class="font-serif text-primary/60 text-balance"
          >
            {frontmatter.description}
          </Text>
        </div>
      </div>
      {frontmatter.reflections && frontmatter.reflections.length > 0 && (
        <div class="space-y-4 border-t border-dotted border-primary/10 pt-2 mt-2">
          <Text tag="h2" variant="textSM" class="font-medium text-primary">
            Thoughts and Reflections
          </Text>
          {frontmatter.reflections.map((reflection) => (
            <Text
              tag="p"
              variant="textSM"
              class="font-serif text-primary/60 text-balance italic"
            >
              "{reflection}"
            </Text>
          ))}
        </div>
      )}
      {frontmatter.socials?.website && (
        <div class="flex items-center gap-4 mt-4">
          <a
            href={frontmatter.socials.website}
            class="text-xs text-primary hover:text-primary/60"
            aria-label="Website"
          >
            Website
          </a>
        </div>
      )}
      <div class="prose-ul:text-zinc-500 prose prose-xs prose-headings:font-sans font-serif max-w-none pt-0 prose-a:text-black prose-p:text-zinc-500 prose-code:text-black prose-strong:text-black prose-ol:text-zinc-500 prose-headings:text-black prose-headings:text-base text-sm mt-8 w-full">
          <slot />
        </div>
    </Wrapper>
  </section>

  {
    relatedPosts.length > 0 && (
      <section>
        <Wrapper variant="standard" class="py-12">
          <Text tag="h2" variant="textBase" class="text-primary ">
            More posts from{" "}
            <span class="capitalize">{influenceSlug.replace(/-/g, " ")}</span>
          </Text>

          <div class="flex flex-col pt-2 mt-2 border-t border-dotted gap-2 border-primary/10">
            {relatedPosts.map((post) => (
              <BlogEntry post={post} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
