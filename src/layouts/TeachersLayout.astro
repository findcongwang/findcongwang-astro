---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import CourseEntry from "@/components/courses/CourseEntry.astro";
// Load all posts
import { getCollection } from "astro:content";
// Content
const allCourses = await getCollection("courses");
// Get the team slug from the URL
const teacherSlug = Astro.url.pathname.split("/").filter(Boolean).pop();
// Filter posts by this team (based on slug)
const relatedCourses = allCourses.filter(
  (post) => post.data.teacher === teacherSlug
);

const { frontmatter } = Astro.props;
---

<BaseLayout>
  <section>
    <Wrapper variant="standard" class="pt-24 pb-12 lg:pt-48">
      <div class="flex items-center gap-4">
        <Image
          width={1000}
          height={800}
          alt={frontmatter.image.alt}
          src={frontmatter.image.url}
          class="object-cover object-center size-12 rounded-full"
        />
        <div>
          <Text tag="h1" variant="textBase" class="text-primary">
            {frontmatter.name}
          </Text>

          <Text
            tag="p"
            variant="textBase"
            class="font-serif text-primary/60 text-balance"
          >
            {frontmatter.role}
          </Text>
        </div>
      </div>
      <div class="space-y-4 border-t border-dotted border-primary/10 pt-2 mt-2">
        {
          frontmatter.bio.split("\n").map((paragraph) => (
            <Text
              tag="p"
              variant="textSM"
              class="font-serif text-primary/60 text-balance"
            >
              {paragraph}
            </Text>
          ))
        }
      </div>
      <div class="flex items-center gap-4 mt-4">
        <a
          href={frontmatter.socials.twitter}
          class="text-xs text-primary hover:text-primary/60"
          aria-label="X"
        >
          Twitter
        </a>
        <a
          href={frontmatter.socials.linkedin}
          class="text-xs text-primary hover:text-primary/60"
          aria-label="LinkedIn"
        >
          Linkedin
        </a>
        <a
          href={frontmatter.socials.email}
          class="text-xs text-primary hover:text-primary/60"
          aria-label="Email"
        >
          Email
        </a>
        <a
          href={frontmatter.socials.website}
          class="text-xs text-primary hover:text-primary/60"
          aria-label="Website"
        >
          Website
        </a>
      </div>
    </Wrapper>
  </section>

  {
    relatedCourses.length > 0 && (
      <section>
        <Wrapper variant="standard" class="py-12">
          <Text tag="h2" variant="textBase" class="text-primary ">
            More courses from
            <span class="capitalize">{teacherSlug.replace(/-/g, " ")}</span>
          </Text>

          <div class="flex flex-col pt-2 mt-2 border-t border-dotted gap-2 border-primary/10">
            {relatedCourses.map((post) => (
              <CourseEntry post={post} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
