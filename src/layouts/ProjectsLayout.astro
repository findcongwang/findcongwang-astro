---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "./BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import { getCollection } from "astro:content";
import { getDomainLineages } from "@/utils/domains";

const { frontmatter } = Astro.props;
const pubDate = new Date(frontmatter.pubDate);
const isFuture = pubDate > new Date();
const showWebsite = frontmatter.link && frontmatter.link !== "#";

const allDomains = await getCollection("domains");
const domainLineages = frontmatter.domains
  ? await getDomainLineages(frontmatter.domains, allDomains)
  : [];
---

<BaseLayout>
  <section>
    <Wrapper variant="standard" class="pt-24 pb-12 lg:pt-48">
      <div class="flex items-center gap-4">
        <Image
          width={1000}
          height={800}
          alt={frontmatter.image.alt}
          src={frontmatter.image.url}
          class="object-cover object-center size-12 rounded-full"
        />
        <div>
          <Text tag="h1" variant="textBase" class="text-primary">
            {frontmatter.title}
          </Text>

          <Text
            tag="p"
            variant="textBase"
            class="font-serif text-primary/60 text-balance"
          >
            {frontmatter.description}
          </Text>
        </div>
      </div>
      <div class="mt-8 space-y-1">
        {showWebsite && (
        <div class="flex items-baseline lg:justify-between">
          <Text
            tag="p"
            variant="textSM"
            class="font-medium capitalize text-primary text-balance group-hover:text-white"
          >
            Website
          </Text>
          <span class="flex-1 mx-2 border-b border-dotted border-primary/10"
          ></span>
          <a
            href={frontmatter.link}
            title={frontmatter.title}
            aria-label={frontmatter.title}
            class="flex items-center text-xs text-primary hover:text-primary/60 gap-2 mt-2"
          >
            Visit
          </a>
        </div>
        )}
        <div class="flex items-baseline lg:justify-between">
          <Text
            tag="p"
            variant="textSM"
            class="font-medium capitalize text-primary text-balance group-hover:text-white"
          >
            {isFuture ? "Upcoming" : "Published"}
          </Text>
          <span class="flex-1 mx-2 border-b border-dotted border-primary/10"
          ></span>
          <Text
            tag="p"
            variant="textXS"
            class="flex items-baseline text-primary/60 lg:justify-between"
          >
            <time datetime={pubDate.toISOString().slice(0, 10)}>
              {isFuture ? pubDate.getFullYear().toString() : pubDate.toString().slice(4, 15)}
            </time>
          </Text>
        </div>
        {frontmatter.tags && frontmatter.tags.length > 0 && (
          <div class="flex items-baseline lg:justify-between">
            <Text
              tag="p"
              variant="textSM"
              class="font-medium capitalize text-primary text-balance"
            >
              Tags
            </Text>
            <span class="flex-1 mx-2 border-b border-dotted border-primary/10" />
            <Text tag="p" variant="textXS" class="text-primary/60">
              {frontmatter.tags.join(", ")}
            </Text>
          </div>
        )}
        {domainLineages.length > 0 && (
          <div class="flex items-baseline lg:justify-between">
            <Text
              tag="p"
              variant="textSM"
              class="font-medium capitalize text-primary text-balance"
            >
              Domains
            </Text>
            <span class="flex-1 mx-2 border-b border-dotted border-primary/10" />
            <Text tag="p" variant="textXS" class="text-primary/60">
              {domainLineages.join(", ")}
            </Text>
          </div>
        )}
      </div>

      <Wrapper variant="prose" class="mt-8">
        <slot />
      </Wrapper>
    </Wrapper>
  </section>
</BaseLayout>
